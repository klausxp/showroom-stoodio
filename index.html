<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stoodio Showroom | Model Catalog</title>

    <!-- Google Fonts: Cormorant Garamond (Luxury Serif) & Plus Jakarta Sans (Modern Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,500&family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* === CSS VARIABLES === */
        :root {
            /* High Contrast Minimalism */
            --color-bg: #FFFFFF;
            --color-surface: #FAFAFA;
            --color-surface-hover: #F2F2F2;

            /* Text & Accents */
            --color-text: #050505;
            --color-text-light: #555555;
            --color-text-meta: #888888;

            /* Brand */
            --color-accent: #7C6FCD;
            --color-accent-hover: #6B5EBE;

            /* Borders */
            --color-border: #EEEEEE;
            --color-border-focus: #111111;

            /* Shapes & Animation */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            --badge-rf-bg: #F0FDF4;
            --badge-rf-text: #166534;
            --badge-paid-bg: #F3F0FF;
            --badge-paid-text: #5B21B6;

            --transition-speed: 0.3s;

            /* Typography */
            --font-heading: 'Cormorant Garamond', serif;
            --font-body: 'Plus Jakarta Sans', sans-serif;

            --max-width: 1440px;
        }

        /* === RESET & BASE === */
        html {
            scroll-behavior: smooth;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            overflow-y: scroll;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            font-family: inherit;
            cursor: pointer;
            border: none;
            background: none;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }

        input {
            font-family: inherit;
        }

        .container {
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 0 40px;
        }

        /* === HEADER === */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--color-border);
            height: 90px;
            display: flex;
            align-items: center;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .logo-area {
            display: flex;
            align-items: center;
            /* Changed from baseline to align image properly */
            gap: 16px;
        }

        .logo {
            height: 48px;
            /* Increased logo size */
            width: auto;
            display: block;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: auto;
            /* Fallback */
            transform: translateZ(0);
            /* Force Hardware Acceleration for sharper scaling */
        }

        .tagline {
            font-family: var(--font-body);
            font-size: 14px;
            font-weight: 400;
            font-style: italic;
            color: var(--color-text-meta);
            letter-spacing: 0.05em;
            margin-top: 2px;
        }

        .btn-outline {
            background-color: var(--color-accent);
            color: white;
            padding: 12px 28px;
            border-radius: var(--radius-full);
            font-size: 13px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.12em;
        }

        .btn-outline:hover {
            background-color: var(--color-accent-hover);
        }

        .btn-primary {
            background-color: var(--color-accent);
            color: white;
            padding: 16px 32px;
            border-radius: var(--radius-full);
            font-size: 15px;
            font-weight: 500;
            width: 100%;
            letter-spacing: 0.02em;
        }

        .btn-primary:hover {
            background-color: var(--color-accent-hover);
        }

        .header-nav-link {
            font-family: var(--font-body);
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-meta);
            position: relative;
            padding-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: color var(--transition-speed) ease;
        }

        .header-nav-link:hover,
        .header-nav-link.active {
            color: var(--color-text);
        }

        .header-nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--color-text);
            transition: width var(--transition-speed) ease;
        }

        .header-nav-link:hover::after,
        .header-nav-link.active::after {
            width: 100%;
        }

        .header-nav-center {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .shortlist-btn {
            font-family: var(--font-body);
            font-size: 14px;
            font-weight: 600;
            color: var(--color-bg);
            background-color: var(--color-text);
            padding: 10px 20px;
            border-radius: var(--radius-full);
            border: 1px solid var(--color-text);
            cursor: pointer;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            line-height: 1;
        }

        .shortlist-btn:hover {
            background-color: transparent;
            color: var(--color-text);
        }

        .shortlist-btn.active-view {
            background-color: var(--color-accent);
            border-color: var(--color-accent);
            color: white;
        }

        @media (max-width: 900px) {
            .header-nav-center {
                display: none;
            }
        }

        /* === HERO SECTION === */
        .hero {
            padding-top: 50px;
            text-align: left;
            margin-bottom: 40px;
        }

        .hero-inner {
            padding-bottom: 40px;
            border-bottom: 1px solid var(--color-border);
        }

        .hero h1 {
            font-family: var(--font-body);
            font-size: clamp(2rem, 4.5vw, 4.5rem);
            font-weight: 600;
            letter-spacing: -0.03em;
            line-height: 1;
            color: var(--color-text);
            max-width: none;
            margin-bottom: 24px;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .hero h1 {
                white-space: normal;
            }
        }

        .hero p {
            font-size: 20px;
            font-weight: 300;
            letter-spacing: 0.01em;
            color: var(--color-text-light);
            max-width: none;
            line-height: 1.6;
        }

        /* === CONTROLS BAR === */
        .controls-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
            gap: 20px;
            margin-bottom: 40px;
        }

        .filters-left,
        .filters-right {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: nowrap;
            white-space: nowrap;
        }

        .filters-right {
            gap: 16px;
        }

        .advanced-filters-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--radius-full);
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .advanced-filters-btn:hover {
            border-color: var(--color-text);
            background-color: var(--color-surface);
        }

        .advanced-filters-btn svg {
            width: 18px;
            height: 18px;
            color: var(--color-text-meta);
        }

        .back-folders-btn:hover {
            border-color: var(--color-text) !important;
            background-color: var(--color-text) !important;
            color: white !important;
        }

        .search-box {
            position: relative;
            width: 100%;
            max-width: 280px;
            flex-shrink: 1;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: var(--color-text-meta);
        }

        .search-input:focus {
            border-color: var(--color-border-focus);
            background-color: var(--color-bg);
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.03);
        }

        .search-input {
            width: 100%;
            padding: 14px 16px 14px 44px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            font-size: 15px;
            font-weight: 400;
            background-color: var(--color-surface);
            color: var(--color-text);
            outline: none;
            transition: border-color var(--transition-speed), background-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        .sort-select {
            padding: 12px 36px 12px 20px;
            border-radius: var(--radius-full);
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            outline: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23111111%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            transition: all var(--transition-speed);
        }

        .sort-select:hover,
        .sort-select:focus {
            border-color: var(--color-text);
            background-color: var(--color-surface);
        }

        .filter-category {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .filter-label {
            font-family: var(--font-body);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-text-meta);
        }

        .pill {
            padding: 10px 20px;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
            background-color: transparent;
            color: var(--color-text-light);
            border: 1px solid transparent;
        }

        .pill:hover {
            color: var(--color-text);
            background-color: var(--color-surface);
        }

        .pill.active {
            background-color: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        .pill.active:hover {
            background-color: var(--color-accent);
            color: white;
        }

        .custom-model-cta {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 8px 12px 8px 24px;
            background-color: var(--color-bg);
            border-radius: var(--radius-full);
            border: 1px solid var(--color-border);
            transition: border-color var(--transition-speed);
        }

        .custom-model-cta:hover {
            border-color: var(--color-accent);
        }

        .custom-model-texts {
            display: flex;
            flex-direction: column;
        }

        .custom-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text);
            letter-spacing: -0.01em;
            line-height: 1.2;
        }

        .custom-subtitle {
            font-size: 13px;
            color: var(--color-text-meta);
        }

        .custom-link {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 700;
            color: white;
            background-color: var(--color-accent);
            padding: 12px 20px;
            border-radius: var(--radius-full);
            transition: background-color var(--transition-speed);
        }

        .custom-link:hover {
            background-color: var(--color-accent-hover);
        }

        /* === GRID === */
        #showroom-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 60px 40px;
            margin-bottom: 120px;
        }

        .model-card {
            display: flex;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            transition: opacity var(--transition-speed);
        }

        .model-card:hover {
            opacity: 0.9;
        }

        .card-image-wrap {
            position: relative;
            width: 100%;
            aspect-ratio: 3/4;
            overflow: hidden;
            background-color: var(--color-surface);
            margin-bottom: 20px;
            /* Removed border, relying on high-quality images and minimal whitespace */
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .model-card:hover .card-image {
            transform: scale(1.04);
        }

        .card-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Centra el botón respecto al texto */
            padding-top: 4px;
        }

        .card-details {
            text-align: left;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 6px;
            /* Define el espacio entre el nombre y los labels */
            width: calc(100% - 48px);
            /* Espacio reservado para el botón */
        }

        .model-name {
            font-family: var(--font-body);
            font-size: 22px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0px;
            /* El gap de card-details se encarga del espacio */
            letter-spacing: -0.02em;
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .model-meta-text {
            font-family: var(--font-body);
            font-size: 13px;
            color: var(--color-text-meta);
            letter-spacing: 0.05em;
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .card-action {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-speed), border-color var(--transition-speed), color var(--transition-speed), transform var(--transition-speed);
            color: var(--color-text-light);
            background-color: var(--color-bg);
        }

        .model-card:hover .card-action {
            background-color: var(--color-text);
            border-color: var(--color-text);
            color: white;
            transform: translateX(4px);
        }

        .fav-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
            cursor: pointer;
            z-index: 10;
            color: var(--color-text);
            transition: all 0.2s ease;
        }

        .header-nav-link {
            background: none;
            border: none;
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            cursor: pointer;
            padding: 0;
            white-space: nowrap;
            color: var(--color-text-meta);
            transition: color 0.2s ease;
        }

        .header-nav-link:hover,
        .header-nav-link.active {
            color: var(--color-text);
        }

        .fav-btn:hover {
            transform: scale(1.1);
            background-color: white;
        }

        [data-role="client"] .fav-btn.active {
            color: #ef4444;
            /* Rojo premium */
        }

        [data-role="client"] .fav-btn.active svg {
            fill: #ef4444;
            stroke: #ef4444;
        }

        [data-role="stoodio"] .fav-btn.active {
            color: #10B981;
            /* Verde esmeralda */
        }

        [data-role="stoodio"] .fav-btn.active svg {
            fill: #10B981;
            stroke: #10B981;
        }


        /* === EMPTY STATE === */
        .empty-state {
            grid-column: 1 / -1;
            padding: 120px 0;
            text-align: center;
            color: var(--color-text-meta);
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            color: var(--color-border);
            margin-bottom: 24px;
            stroke-width: 1;
        }

        .empty-state h3 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 32px;
            color: var(--color-text);
            margin-bottom: 12px;
            font-weight: 500;
        }

        /* === MODAL === */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            overscroll-behavior: contain;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background-color: var(--color-bg);
            width: 90vw;
            max-width: 1600px;
            height: 85vh;
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: row;
            transform: translateY(20px) scale(0.98);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.08);
            /* Sophisticated large shadow */
            border: 1px solid var(--color-border);
        }

        .modal-overlay.active .modal-container {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: -50px;
            right: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            color: var(--color-text);
            background: none;
            border: none;
        }

        .modal-close:hover {
            color: var(--color-text-light);
            transform: scale(1.1);
        }

        .modal-left {
            width: 65%;
            padding: 24px;
            display: flex;
            flex-direction: row;
            /* Changed to row for side-by-side */
            gap: 24px;
            align-items: stretch;
        }

        .modal-main-image-wrap {
            flex: 1;
            height: 100%;
            overflow: hidden;
            background-color: var(--color-surface);
        }

        .modal-main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-gallery-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            /* Vertical wrapper */
            align-items: center;
            width: 100px;
            /* Fixed width for gallery */
            height: 100%;
            gap: 12px;
        }

        .modal-gallery {
            display: flex;
            flex-direction: column;
            /* Vertical thumbnails */
            gap: 12px;
            width: 100%;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            /* Firefox */
            flex: 1;
            scroll-behavior: smooth;
        }

        .modal-gallery::-webkit-scrollbar {
            display: none;
            /* Safari and Chrome */
        }

        .gallery-nav-btn {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            z-index: 5;
            flex-shrink: 0;
            opacity: 0.8;
            transition: opacity var(--transition-speed), background-color var(--transition-speed), color var(--transition-speed), border-color var(--transition-speed);
        }

        .gallery-nav-btn:hover {
            opacity: 1;
            background-color: var(--color-text);
            color: white;
            border-color: var(--color-text);
        }

        .gallery-nav-prev {
            margin-bottom: 0;
        }

        .gallery-nav-next {
            margin-top: 0;
        }

        .gallery-thumb {
            width: 100%;
            aspect-ratio: 3/4;
            /* Vertical aspect ratio */
            object-fit: cover;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s ease;
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        .gallery-thumb:hover {
            opacity: 0.8;
        }

        .gallery-thumb.active {
            opacity: 1;
        }

        .modal-right {
            width: 35%;
            padding: 60px 50px;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--color-border);
            background-color: var(--color-surface);
        }

        .modal-name {
            font-family: var(--font-body);
            font-size: clamp(24px, 3vw, 48px);
            font-weight: 600;
            line-height: 0.95;
            margin-bottom: 12px;
            letter-spacing: -0.03em;
            word-wrap: break-word;
        }

        .modal-id {
            color: var(--color-text-meta);
            font-size: 14px;
            letter-spacing: 0.1em;
            margin-bottom: 48px;
            text-transform: uppercase;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 140px 1fr;
            gap: 24px;
            font-size: 15px;
            margin-bottom: auto;
            /* pushes actions to bottom */
        }

        .info-label {
            color: var(--color-text-meta);
            font-weight: 500;
        }

        .info-val {
            font-weight: 400;
            color: var(--color-text);
        }

        .modal-actions {
            margin-top: 48px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .secondary-link {
            color: var(--color-text-light);
            font-size: 14px;
            text-decoration: underline;
            text-decoration-color: transparent;
            transition: text-decoration-color 0.3s ease;
            text-align: center;
        }

        .secondary-link:hover {
            color: var(--color-text);
            text-decoration-color: var(--color-text);
        }

        /* === FOOTER === */
        .footer {
            border-top: 1px solid var(--color-border);
            padding: 40px 0;
            text-align: center;
            font-size: 13px;
            color: var(--color-text-meta);
            font-weight: 300;
        }

        /* === RESPONSIVE === */
        @media (max-width: 1200px) {
            #showroom-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 40px 30px;
            }

            .modal-container {
                width: 90%;
            }
        }

        /* === ADVANCED FILTERS DRAWER === */
        .filters-drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(4px);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .filters-drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .filters-drawer {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background-color: var(--color-bg);
            z-index: 2001;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.05);
            padding: 40px;
            display: flex;
            flex-direction: column;
            transition: right 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .filters-drawer-overlay.active .filters-drawer {
            right: 0;
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .drawer-header h2 {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .drawer-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--color-text);
            padding: 8px;
            margin-right: -8px;
            transition: transform 0.3s ease;
        }

        .drawer-close:hover {
            transform: rotate(90deg);
        }

        .drawer-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 10px;
            /* Space for scrollbar */
            margin-right: -10px;
            /* Hide scrollbar bleed */
            display: flex;
            flex-direction: column;
            -webkit-overflow-scrolling: touch;
        }

        /* Custom Scrollbar for Drawer */
        .drawer-content::-webkit-scrollbar {
            width: 4px;
        }

        .drawer-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .drawer-content::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 10px;
        }

        .drawer-content::-webkit-scrollbar-thumb:hover {
            background: var(--color-text-meta);
        }

        .drawer-section {
            margin-bottom: 32px;
        }

        .drawer-section-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-text-meta);
            margin-bottom: 16px;
            display: block;
        }

        .drawer-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .drawer-option-pill {
            padding: 10px 18px;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text-light);
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .drawer-option-pill:hover {
            border-color: var(--color-text);
            color: var(--color-text);
        }

        .drawer-option-pill.active {
            background-color: var(--color-text);
            color: white;
            border-color: var(--color-text);
        }

        /* === PRICE SLIDER STYLES === */
        .price-range-container {
            padding: 10px 0 20px 0;
        }

        .price-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .price-label-current {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-text);
            font-family: var(--font-body);
        }

        .price-limit {
            font-size: 12px;
            color: var(--color-text-meta);
            font-weight: 500;
        }

        .custom-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: var(--color-border);
            border-radius: 2px;
            outline: none;
            margin: 15px 0;
        }

        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--color-text);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--color-bg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.2s ease;
        }

        .custom-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .custom-slider::-webkit-slider-thumb:active {
            transform: scale(1.05);
        }

        .custom-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--color-text);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--color-bg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease;
        }

        .drawer-footer {
            margin-top: auto;
            display: flex;
            gap: 16px;
            padding-top: 24px;
            border-top: 1px solid var(--color-border);
        }

        .drawer-footer .btn-primary {
            flex: 1;
        }

        .drawer-footer .btn-secondary {
            padding: 12px 24px;
            border-radius: var(--radius-full);
            border: 1px solid var(--color-border);
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        /* === CUSTOM MODELS SECTION === */
        .custom-models-section {
            padding: 100px 0;
            border-top: 1px solid var(--color-border);
            margin-top: 60px;
        }

        .custom-models-header {
            text-align: center;
            margin-bottom: 64px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .custom-models-header h2 {
            font-family: var(--font-body);
            font-size: clamp(2rem, 4.5vw, 4.5rem);
            font-weight: 600;
            letter-spacing: -0.03em;
            margin-bottom: 24px;
            color: var(--color-text);
            line-height: 1;
        }

        .custom-models-header p {
            font-size: 20px;
            font-weight: 300;
            letter-spacing: 0.01em;
            color: var(--color-text-light);
            line-height: 1.6;
            margin-bottom: 0;
        }

        .custom-cards-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 32px;
        }

        @media (max-width: 900px) {
            .custom-cards-container {
                grid-template-columns: 1fr;
            }
        }

        .custom-card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 24px;
            padding: 48px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform var(--transition-speed), box-shadow var(--transition-speed), border-color var(--transition-speed);
        }

        .custom-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.04);
            border-color: var(--color-border-focus);
        }

        .custom-label {
            font-family: var(--font-body);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-text-meta);
            display: inline-block;
            margin-bottom: 16px;
        }

        .custom-card h3 {
            font-family: var(--font-body);
            font-size: 32px;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 16px;
            color: var(--color-text);
        }

        .custom-desc {
            font-size: 16px;
            color: var(--color-text-light);
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .custom-process {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 48px;
        }

        .process-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 14px;
            color: var(--color-text);
            flex-shrink: 0;
        }

        .step-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .step-text strong {
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 15px;
            color: var(--color-text);
        }

        .step-text span {
            font-family: var(--font-body);
            font-size: 14px;
            color: var(--color-text-meta);
            line-height: 1.5;
        }

        .custom-card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 32px;
            border-top: 1px solid var(--color-border);
            gap: 16px;
            flex-wrap: wrap;
        }

        .custom-price-tag {
            font-family: var(--font-body);
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            background-color: var(--color-bg);
            padding: 8px 16px;
            border-radius: var(--radius-full);
            border: 1px solid var(--color-border);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 60px;
            margin-bottom: 40px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: var(--radius-full);
            border: 1px solid var(--color-border);
            background-color: transparent;
            color: var(--color-text-light);
            font-size: 14px;
            font-weight: 500;
            transition: all var(--transition-speed);
        }

        .page-btn:hover:not(:disabled) {
            border-color: var(--color-text);
            color: var(--color-text);
        }

        .page-btn.active {
            background-color: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        @media (max-width: 900px) {
            #showroom-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .hero h1 {
                font-size: 3.5rem;
            }

            .modal-container {
                flex-direction: column;
                height: 95vh;
            }

            .modal-left,
            .modal-right {
                width: 100%;
            }

            .modal-left {
                padding: 20px;
                height: 50%;
            }

            .modal-right {
                padding: 40px 30px;
                height: 50%;
                border-left: none;
                border-top: 1px solid var(--color-border);
            }

            .modal-name {
                font-size: 36px;
                margin-bottom: 4px;
            }

            .modal-id {
                margin-bottom: 24px;
            }

            .info-grid {
                gap: 12px;
            }

            .custom-cards-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            #showroom-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 0 24px;
            }

            .hero {
                padding-top: 60px;
                padding-bottom: 60px;
            }

            .controls-wrapper {
                flex-direction: column;
                align-items: stretch;
                gap: 24px;
            }

            .search-box {
                width: 100%;
            }

            .filters-group {
                gap: 16px;
            }

            .custom-model-cta {
                justify-content: space-between;
                padding: 12px 16px;
            }
        }

        /* === ANIMACIÓN HEART DUST === */
        .flying-heart {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            color: #ef4444;
            /* Rojo/Rosado premium */
            animation: fly-to-cart 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes fly-to-cart {
            0% {
                transform: scale(1) translateY(0);
                opacity: 0;
            }

            15% {
                transform: scale(1.5) translateY(-15px);
                opacity: 1;
            }

            100% {
                transform: translate(var(--dx), var(--dy)) scale(0.2);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <!-- === HEADER === -->
    <header class="header">
        <div class="container header-content">
            <!-- Left: Identity & Reset -->
            <div class="header-left">
                <button class="logo-area" id="logoLink" style="background:none; border:none; padding:0; cursor:pointer;"
                    aria-label="Reset and go to top">
                    <img src="Logo Stoodio.png" alt="Stoodio.AI" class="logo">
                    <div class="tagline">Model Showroom</div>
                </button>
            </div>

            <!-- Right: Navigation & B2B Action -->
            <div class="header-right" style="display: flex; align-items: center; gap: 48px;">
                <nav class="header-nav-center">
                    <button id="catalogBtn" class="header-nav-link active">Catalog</button>
                    <a href="#custom-models" class="header-nav-link">Custom Models</a>
                </nav>

                <button id="shortlistViewBtn" class="shortlist-btn">
                    <!-- El icono cambia según el Rol -->
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="margin-top: -1px;">
                        <path id="shortlist-icon-path"
                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                        </path>
                    </svg>
                    <span id="shortlistBtnText" style="display: flex; align-items: center;">Shortlist (<span
                            id="shortlist-count">0</span>)</span>
                </button>
            </div>
        </div>
    </header>

    <!-- === HERO === -->
    <section class="hero container">
        <div class="hero-inner">
            <h1>Discover our Model Catalog</h1>
            <p>Browse, filter and find the perfect model for your next campaign.</p>
        </div>
    </section>

    <!-- === CONTROLS === -->
    <section class="controls-section container">
        <div class="controls-wrapper">
            <div class="filters-left">
                <!-- Type Filter -->
                <div class="filter-category">
                    <span class="filter-label">Subject:</span>
                    <div id="typeFilters">
                        <button class="pill active" data-filter="all">All</button>
                        <button class="pill" data-filter="Digital Twin">Digital Twins</button>
                        <button class="pill" data-filter="Avatar">Avatars</button>
                        <button class="pill" data-filter="Real Model">Real Models</button>
                    </div>
                </div>

                <!-- License Filter -->
                <div class="filter-category">
                    <span class="filter-label">License:</span>
                    <div id="licenseFilters">
                        <button class="pill active" data-filter="all">All</button>
                        <button class="pill" data-filter="royalty-free">Royalty Free</button>
                        <button class="pill" data-filter="paid">Available to License</button>
                    </div>
                </div>
            </div>

            <div class="filters-right">
                <!-- Search -->
                <div class="search-box">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="searchInput" name="search" autocomplete="off" class="search-input"
                        placeholder="Search by name...">
                </div>

                <!-- Advanced Filters Button -->
                <button id="advancedFiltersBtn" class="advanced-filters-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <line x1="4" y1="21" x2="4" y2="14"></line>
                        <line x1="4" y1="10" x2="4" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12" y2="3"></line>
                        <line x1="20" y1="21" x2="20" y2="16"></line>
                        <line x1="20" y1="12" x2="20" y2="3"></line>
                        <line x1="1" y1="14" x2="7" y2="14"></line>
                        <line x1="9" y1="8" x2="15" y2="8"></line>
                        <line x1="17" y1="16" x2="23" y2="16"></line>
                    </svg>
                    Filters
                </button>
            </div>
        </div>
    </section>

    <!-- === GRID === -->
    <main class="container">
        <div id="showroom-grid">
            <!-- Cards will be populated here via JS -->
        </div>

        <!-- Pagination controls -->
        <div class="pagination" id="paginationControls">
            <!-- Pagination buttons will be populated here via JS -->
        </div>
    </main>

    <!-- === CUSTOM MODELS SECTION === -->
    <section id="custom-models" class="custom-models-section container">
        <div class="custom-models-header">
            <h2>Custom Models</h2>
            <p>Don't see exactly what you need? We build bespoke AI talent tailored to your brand's unique requirements.
            </p>
        </div>

        <div class="custom-cards-container">
            <!-- Card 1: Custom Avatars -->
            <div class="custom-card">
                <div class="custom-card-content">
                    <span class="custom-label">Created from scratch</span>
                    <h3>Custom Avatars</h3>
                    <p class="custom-desc">We design and generate a unique, exclusive AI face based on your exact
                        specifications and brand guidelines.</p>

                    <div class="custom-process">
                        <div class="process-step">
                            <div class="step-number">1</div>
                            <div class="step-text">
                                <strong>Briefing & Concept</strong>
                                <span>Tell us your vision, demographic needs, and aesthetic requirements.</span>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="step-number">2</div>
                            <div class="step-text">
                                <strong>Creation & Iteration</strong>
                                <span>We generate initial concepts and refine them based on your feedback.</span>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="step-number">3</div>
                            <div class="step-text">
                                <strong>Final Delivery</strong>
                                <span>Your exclusive, brand-owned Avatar is ready for all your campaigns.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="custom-card-footer">
                    <span class="custom-price-tag">Custom Pricing</span>
                    <a href="mailto:sales@stoodio.ai?subject=Custom%20Avatar%20Request" class="btn-primary">Start your
                        Custom Project</a>
                </div>
            </div>

            <!-- Card 2: Custom Casting -->
            <div class="custom-card">
                <div class="custom-card-content">
                    <span class="custom-label">Bespoke Digital Twins</span>
                    <h3>Custom Casting</h3>
                    <p class="custom-desc">Bring your own talent or let us find the perfect real-world model to digitize
                        exclusively for your brand.</p>

                    <div class="custom-process">
                        <div class="process-step">
                            <div class="step-number">1</div>
                            <div class="step-text">
                                <strong>Scouting / Proposal</strong>
                                <span>We cast the ideal model through agencies, or you provide your own talent.</span>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="step-number">2</div>
                            <div class="step-text">
                                <strong>Capture Session</strong>
                                <span>We scan and digitize the talent using our state-of-the-art studio setup.</span>
                            </div>
                        </div>
                        <div class="process-step">
                            <div class="step-number">3</div>
                            <div class="step-text">
                                <strong>Integration</strong>
                                <span>Your new Digital Twin is processed, rigged, and ready for production.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="custom-card-footer">
                    <span class="custom-price-tag">Custom Pricing</span>
                    <a href="mailto:sales@stoodio.ai?subject=Custom%20Casting%20Request" class="btn-primary">Talk to our
                        team</a>
                </div>
            </div>
        </div>
    </section>

    <!-- === ADVANCED FILTERS DRAWER === -->
    <div class="filters-drawer-overlay" id="filtersOverlay">
        <div class="filters-drawer">
            <div class="drawer-header">
                <h2>Filters</h2>
                <button class="drawer-close" id="closeDrawer">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="drawer-content">
                <!-- Price Range Section -->
                <div class="drawer-section">
                    <span class="drawer-section-title">Budget (Max Price)</span>
                    <div class="price-range-container">
                        <div class="price-display">
                            <span id="priceValue" class="price-label-current">Up to $1000</span>
                            <span class="price-limit">$1000+</span>
                        </div>
                        <input type="range" id="priceRange" class="custom-slider" min="0" max="1000" step="50"
                            value="1000">
                    </div>
                </div>

                <!-- Gender Section -->
                <div class="drawer-section">
                    <span class="drawer-section-title">Gender</span>
                    <div class="drawer-options" id="genderOptions">
                        <button class="drawer-option-pill active" data-gender="all">All</button>
                        <button class="drawer-option-pill" data-gender="Female">Female</button>
                        <button class="drawer-option-pill" data-gender="Male">Male</button>
                        <button class="drawer-option-pill" data-gender="Non-binary">Non-binary</button>
                    </div>
                </div>

                <!-- Age Range Section -->
                <div class="drawer-section">
                    <span class="drawer-section-title">Age Range</span>
                    <div class="drawer-options" id="ageOptions">
                        <button class="drawer-option-pill active" data-age="all">All</button>
                        <button class="drawer-option-pill" data-age="teens">Teens (< 20)</button>
                                <button class="drawer-option-pill" data-age="20s">20s (20-29)</button>
                                <button class="drawer-option-pill" data-age="30s">30s (30-39)</button>
                                <button class="drawer-option-pill" data-age="40s">40s (40-49)</button>
                                <button class="drawer-option-pill" data-age="50+">50+ (Mature)</button>
                    </div>
                </div>

                <!-- Region Section -->
                <div class="drawer-section">
                    <span class="drawer-section-title">Location / Region</span>
                    <div class="drawer-options" id="regionOptions">
                        <button class="drawer-option-pill active" data-region="all">All</button>
                        <button class="drawer-option-pill" data-region="North America">North America</button>
                        <button class="drawer-option-pill" data-region="Latin America">Latin America</button>
                        <button class="drawer-option-pill" data-region="Europe">Europe</button>
                        <button class="drawer-option-pill" data-region="Middle East & Africa">Middle East &
                            Africa</button>
                        <button class="drawer-option-pill" data-region="Asia Pacific">Asia Pacific</button>
                    </div>
                </div>
            </div>

            <div class="drawer-footer">
                <button class="btn-secondary" id="clearFiltersBtn">Clear All</button>
                <button class="btn-primary" id="applyFiltersBtn">Show Results</button>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            &copy; 2026 Stoodio.AI &middot; All rights reserved &middot; klausfreiberg@modelmanagement.com
        </div>
    </footer>

    <!-- === MODAL === -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-container" id="modalContainer">
            <button class="modal-close" id="closeModal" aria-label="Close modal">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" viewBox="0 0 24 24">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <div class="modal-left">
                <div class="modal-gallery-wrapper" id="modalGalleryWrapper" style="display: none;">
                    <button class="gallery-nav-btn gallery-nav-prev" id="galleryPrevBtn" aria-label="Previous image">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <polyline points="18 15 12 9 6 15"></polyline>
                        </svg>
                    </button>

                    <div class="modal-gallery" id="modalGallery">
                        <!-- Thumbnails populated here -->
                    </div>

                    <button class="gallery-nav-btn gallery-nav-next" id="galleryNextBtn" aria-label="Next image">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>

                <div class="modal-main-image-wrap">
                    <img src="" alt="Model Cover" class="modal-main-image" id="modalMainImage" width="600" height="800">
                </div>
            </div>

            <div class="modal-right">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <h2 class="modal-name" id="modalName">Name</h2>
                        <div class="modal-id" id="modalId">ID</div>
                    </div>
                    <button class="fav-btn" id="modalFavBtn" aria-label="Toggle Favorite"
                        style="position: static; margin-top: 8px;">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <path
                                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                            </path>
                        </svg>
                    </button>
                </div>

                <div class="info-grid">
                    <div class="info-label">Gender</div>
                    <div class="info-val" id="modalGender">-</div>

                    <div class="info-label">Age</div>
                    <div class="info-val" id="modalAge">-</div>

                    <div class="info-label">Subject Type</div>
                    <div class="info-val" id="modalType">Type</div>

                    <div class="info-label">Location</div>
                    <div class="info-val" id="modalLocation">
                        <span id="modalCountry">-</span>
                        <img id="modalFlag" src="" alt=""
                            style="width: 20px; vertical-align: middle; margin-left: 8px; display: none;">
                    </div>

                    <div class="info-label">License</div>
                    <div class="info-val" id="modalLicense">License</div>

                    <div class="info-label">Price</div>
                    <div class="info-val" id="modalPrice">Price</div>
                </div>

                <div class="modal-actions">
                    <button class="btn-primary" id="requestModelBtn">Request this Model</button>
                    <a href="mailto:sales@stoodio.ai" class="secondary-link">Talk to our sales team</a>
                </div>
            </div>
        </div>
    </div>

    <!-- === JAVASCRIPT === -->
    <script>
        /* === MOCK DATA === */
        const MODELS = [
            { id: "ST-001", firstName: "Sofia", lastName: "Reyes", type: "Avatar", gender: "Female", age: 24, country: "Spain", countryCode: "es", region: "Europe", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1469334031218-e382a71b716b?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-002", firstName: "Marcus", lastName: "Chen", type: "Digital Twin", gender: "Male", age: 28, country: "China", countryCode: "cn", region: "Asia Pacific", license: "paid", price: 299, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "RM-001", firstName: "Martina", lastName: "Gomez", type: "Real Model", gender: "Female", age: 21, country: "Argentina", countryCode: "ar", region: "Latin America", license: "paid", price: 800, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "RM-002", firstName: "Hugo", lastName: "Silva", type: "Real Model", gender: "Male", age: 25, country: "Spain", countryCode: "es", region: "Europe", license: "paid", price: 750, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-003", firstName: "Elena", lastName: "Vassiliev", type: "Avatar", gender: "Female", age: 26, country: "Russia", countryCode: "ru", region: "Europe", license: "paid", price: 499, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1531123897727-8f129e1bf98c?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-004", firstName: "David", lastName: "Okafor", type: "Digital Twin", gender: "Male", age: 31, country: "Nigeria", countryCode: "ng", region: "Middle East & Africa", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-005", firstName: "Yuri", lastName: "Kato", type: "Avatar", gender: "Female", age: 22, country: "Japan", countryCode: "jp", region: "Asia Pacific", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1513207565459-d7f36bfa1222?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1513207565459-d7f36bfa1222?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1550927407-50e2bd128b81?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-006", firstName: "Anna", lastName: "Svensson", type: "Digital Twin", gender: "Female", age: 25, country: "Sweden", countryCode: "se", region: "Europe", license: "paid", price: 599, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-007", firstName: "Julian", lastName: "Silva", type: "Avatar", gender: "Male", age: 27, country: "Brazil", countryCode: "br", region: "Latin America", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-008", firstName: "Chloe", lastName: "Dubois", type: "Digital Twin", gender: "Female", age: 23, country: "France", countryCode: "fr", region: "Europe", license: "paid", price: 399, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-009", firstName: "Liam", lastName: "O'Connor", type: "Avatar", gender: "Male", age: 29, country: "Ireland", countryCode: "ie", region: "Europe", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-010", firstName: "Zara", lastName: "Ali", type: "Digital Twin", gender: "Female", age: 24, country: "Pakistan", countryCode: "pk", region: "Asia Pacific", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-011", firstName: "Nadia", lastName: "Popova", type: "Avatar", gender: "Female", age: 27, country: "Ukraine", countryCode: "ua", region: "Europe", license: "paid", price: 450, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-012", firstName: "Ethan", lastName: "Wright", type: "Digital Twin", gender: "Male", age: 26, country: "United Kingdom", countryCode: "gb", region: "Europe", license: "paid", price: 299, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-013", firstName: "Isabella", lastName: "Russo", type: "Avatar", gender: "Female", age: 21, country: "Italy", countryCode: "it", region: "Europe", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-014", firstName: "Mateo", lastName: "Costa", type: "Digital Twin", gender: "Male", age: 30, country: "Portugal", countryCode: "pt", region: "Europe", license: "paid", price: 349, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-015", firstName: "Lina", lastName: "Kovalenko", type: "Avatar", gender: "Female", age: 28, country: "Ukraine", countryCode: "ua", region: "Europe", license: "paid", price: 550, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-016", firstName: "Arjun", lastName: "Desai", type: "Digital Twin", gender: "Male", age: 29, country: "India", countryCode: "in", region: "Asia Pacific", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-017", firstName: "Mia", lastName: "Tan", type: "Avatar", gender: "Female", age: 23, country: "Singapore", countryCode: "sg", region: "Asia Pacific", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1513207565459-d7f36bfa1222?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1513207565459-d7f36bfa1222?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-018", firstName: "Lucas", lastName: "Muller", type: "Digital Twin", gender: "Male", age: 26, country: "Germany", countryCode: "de", region: "Europe", license: "paid", price: 420, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-019", firstName: "Olivia", lastName: "Smith", type: "Avatar", gender: "Female", age: 25, country: "USA", countryCode: "us", region: "North America", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-020", firstName: "Noah", lastName: "Williams", type: "Digital Twin", gender: "Male", age: 27, country: "USA", countryCode: "us", region: "North America", license: "paid", price: 380, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-021", firstName: "Aria", lastName: "Jansen", type: "Avatar", gender: "Female", age: 24, country: "Netherlands", countryCode: "nl", region: "Europe", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-022", firstName: "Elijah", lastName: "Brown", type: "Digital Twin", gender: "Male", age: 32, country: "Canada", countryCode: "ca", region: "North America", license: "royalty-free", price: null, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1480455624313-e29b44bbfde1?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1480455624313-e29b44bbfde1?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-023", firstName: "Zoe", lastName: "Martin", type: "Avatar", gender: "Female", age: 25, country: "France", countryCode: "fr", region: "Europe", license: "paid", price: 600, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=1200&q=80"], isPublic: true },
            { id: "ST-024", firstName: "Leo", lastName: "Garcia", type: "Digital Twin", gender: "Male", age: 29, country: "Mexico", countryCode: "mx", region: "Latin America", license: "paid", price: 310, currency: "USD", coverPhoto: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=800&q=80", portfolioPhotos: ["https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=1200&q=80", "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?auto=format&fit=crop&w=1200&q=80"], isPublic: true }
        ];

        /* === STATE === */
        // Estado Inicial
        let state = {
            genderFilter: 'all',
            ageRangeFilter: 'all',
            regionFilter: 'all',
            typeFilters: [],
            licenseFilters: [],
            searchQuery: '',
            showShortlistOnly: false,
            shortlist: JSON.parse(localStorage.getItem('stoodio_shortlist')) || [], // Sync with LocalStorage on load
            currentPage: 1,
            itemsPerPage: 12,
            maxPrice: 1000,
            isAdmin: false,
            role: 'stoodio', // 'stoodio' o 'client'
            isCuratedCatalog: false, // Si es true, la BD se limita a lo enviado
            isReviewView: false, // Si es true, oculta controles y form de share
            folders: null, // Guardará la estructura de carpetas si viene por URL (ej: { "Female": ["ST-001"], "Male": ["ST-002"] })
            activeFolder: null // La carpeta que el cliente está viendo en ese momento
        };

        // Cache del DOM
        const html = document.documentElement;
        let originalModels = [...MODELS]; // Mantiene los 50 originales intactos
        let filteredModels = [...MODELS];
        const gridEl = document.getElementById("showroom-grid");
        const searchInput = document.getElementById("searchInput");
        const typeFilterBtns = document.querySelectorAll("#typeFilters .pill");
        const licenseFilterBtns = document.querySelectorAll("#licenseFilters .pill");
        const priceRange = document.getElementById("priceRange");
        const priceValue = document.getElementById("priceValue");

        const advancedFiltersBtn = document.getElementById("advancedFiltersBtn");
        const filtersOverlay = document.getElementById("filtersOverlay");
        const closeDrawerBtn = document.getElementById("closeDrawer");
        const applyFiltersBtn = document.getElementById("applyFiltersBtn");
        const clearFiltersBtn = document.getElementById("clearFiltersBtn");

        const genderBtns = document.querySelectorAll("#genderOptions .drawer-option-pill");
        const ageBtns = document.querySelectorAll("#ageOptions .drawer-option-pill");
        const regionBtns = document.querySelectorAll("#regionOptions .drawer-option-pill");

        const modalOverlay = document.getElementById("detailModal");
        const closeModalBtn = document.getElementById("closeModal");

        const catalogBtn = document.getElementById("catalogBtn");
        const shortlistViewBtn = document.getElementById("shortlistViewBtn");
        const shortlistCountText = document.getElementById("shortlistCountText");

        /* === RENDER LOGIC === */
        function renderCards() {
            // Toggle Custom Models visibility
            const customModelsSection = document.getElementById("custom-models");
            if (customModelsSection) {
                customModelsSection.style.display = state.showShortlistOnly ? "none" : "block";
            }

            // Toggle Header Pre-selection Button Visibility
            const headerBtn = document.getElementById("shortlistViewBtn");
            const navCenter = document.querySelector(".header-nav-center");
            if (headerBtn) {
                // Ocultar SOLO si es cliente curado Y tiene carpetas Y está en la raíz de carpetas (no hya activeFolder)
                const isAtFolderRoot = state.role === 'client' && state.isCuratedCatalog && state.folders && !state.activeFolder && !state.showShortlistOnly;

                if (isAtFolderRoot) {
                    headerBtn.style.display = "none";
                    if (navCenter) navCenter.style.display = "none";
                } else {
                    headerBtn.style.display = "flex";
                    if (navCenter) navCenter.style.display = ""; // Vuelve al comportamiento CSS
                }
            }

            // --- VISTA DE CARPETAS (Para URLs catalog folder) ---
            const isFolderView = state.role === 'client' && state.folders && Object.keys(state.folders).length > 0 && !state.activeFolder && !state.showShortlistOnly;
            if (isFolderView) {
                // Ocultar controles de filtro COMPLETAMENTE en vista de RAÍZ de carpetas
                const controlsWrapper = document.querySelector(".controls-wrapper");
                if (controlsWrapper) controlsWrapper.style.display = "none";
                if (customModelsSection) customModelsSection.style.display = "none";

                // Dibujamos las grandes tarjetas representativas de las carpetas
                gridEl.innerHTML = "";

                const foldersContainer = document.createElement("div");
                foldersContainer.style.display = "grid";
                foldersContainer.style.gridTemplateColumns = "repeat(auto-fill, minmax(320px, 1fr))";
                foldersContainer.style.gap = "24px";
                foldersContainer.style.width = "100%";
                foldersContainer.style.gridColumn = "1 / -1";

                Object.keys(state.folders).forEach(folderName => {
                    const idsInFolder = state.folders[folderName];
                    const count = idsInFolder.length;

                    // Buscar la primera imagen de la carpeta para usarla de cover
                    const firstModel = MODELS.find(m => idsInFolder.includes(m.id));
                    const coverUrl = firstModel ? firstModel.coverPhoto : 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=800&q=80';

                    const folderCard = document.createElement("div");
                    folderCard.className = "card folder-card";
                    folderCard.style.cursor = "pointer";
                    folderCard.style.position = "relative";
                    folderCard.style.overflow = "hidden";
                    folderCard.style.minHeight = "420px";
                    folderCard.style.aspectRatio = "3/4";
                    folderCard.onclick = () => {
                        state.activeFolder = folderName;
                        renderCards(); // Re-renderizará mostrando fotos
                    };

                    folderCard.innerHTML = `
                        <div style="position: absolute; inset: 0; background-image: url('${coverUrl}'); background-size: cover; background-position: center; transition: transform 0.3s ease;"></div>
                        <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 100%);"></div>
                        <div style="position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: flex-end; padding: 32px;">
                            <h3 style="color: white; font-family: var(--font-body); font-weight: 500; font-size: 22px; letter-spacing: -0.01em; margin-bottom: 6px;">${folderName}</h3>
                            <span style="color: rgba(255,255,255,0.8); font-size: 14px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em;">${count} Model${count !== 1 ? 's' : ''} &rarr;</span>
                        </div>
                    `;

                    // Hover effect
                    folderCard.addEventListener('mouseenter', () => { folderCard.children[0].style.transform = 'scale(1.05)'; });
                    folderCard.addEventListener('mouseleave', () => { folderCard.children[0].style.transform = 'scale(1)'; });

                    foldersContainer.appendChild(folderCard);
                });

                gridEl.appendChild(foldersContainer);
                renderPagination(0); // Ocultar paginacion
                return;
            }

            // --- VISTA DENTRO DE UNA CARPETA ---
            const controlsWrapper = document.querySelector(".controls-wrapper");
            const typeFilterContainer = document.querySelector('.filter-category:has(#typeFilters)');
            const genderDrawerSection = document.querySelector('.drawer-section:has(#genderOptions)');

            if (state.activeFolder) {
                // Restaurar filtros cuando estamos DENTRO de una carpeta
                if (controlsWrapper) controlsWrapper.style.display = "flex";

                // NUNCA ocultar Subject (typeFilterContainer), el usuario lo quiere ver.
                if (typeFilterContainer) typeFilterContainer.style.display = "block";

                // Ocultar SOLO el género en el drawer si es una carpeta de género
                const isGenderFolder = ["Female", "Male"].includes(state.activeFolder);
                if (genderDrawerSection) {
                    genderDrawerSection.style.display = isGenderFolder ? "none" : "block";
                }
            } else if (!isFolderView) {
                // Asegurar que los filtros se vean en vista normal (browse/curated grid)
                if (controlsWrapper) controlsWrapper.style.display = "flex";
                if (typeFilterContainer) typeFilterContainer.style.display = "block";
                if (genderDrawerSection) genderDrawerSection.style.display = "block";
            }

            // Botón de Volver a Carpetas y Título
            let backButtonHtml = '';
            if (state.role === 'client' && state.folders && state.activeFolder) {
                backButtonHtml = `
                    <div style="grid-column: 1 / -1; margin-bottom: 32px; display: flex; flex-direction: column; gap: 16px;">
                        <div>
                            <button class="back-folders-btn" onclick="state.activeFolder = null; renderCards();" style="display: inline-flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: var(--color-text); text-decoration: none; border: 1px solid var(--color-border); padding: 8px 16px; border-radius: 20px; background: var(--color-surface); cursor: pointer; transition: all 0.2s ease;">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                                Back to Categories
                            </button>
                        </div>
                        <h2 style="font-family: var(--font-body); font-size: 42px; font-weight: 700; color: var(--color-text); margin: 0; letter-spacing: -0.02em;">${state.activeFolder}</h2>
                    </div>
                `;
            }

            // Filter
            const filtered = originalModels.filter(model => {
                if (!model.isPublic) return false;

                if (state.showShortlistOnly && !state.shortlist.includes(model.id)) return false;

                // Si estamos en una carpeta específica, solo mostrar esos
                if (state.activeFolder && state.folders[state.activeFolder]) {
                    if (!state.folders[state.activeFolder].includes(model.id)) return false;
                }

                // Search
                const q = state.searchQuery.toLowerCase();
                const matchesSearch = !q ||
                    model.firstName.toLowerCase().includes(q) ||
                    model.lastName.toLowerCase().includes(q) ||
                    model.id.toLowerCase().includes(q);

                const matchesType = state.typeFilters.length === 0 || state.typeFilters.includes(model.type);
                const matchesLicense = state.licenseFilters.length === 0 || state.licenseFilters.includes(model.license);

                // Advanced Filters
                const matchesGender = state.genderFilter === "all" || model.gender === state.genderFilter;
                const matchesRegion = state.regionFilter === "all" || model.region === state.regionFilter;

                let matchesAge = true;
                if (state.ageRangeFilter !== "all") {
                    const age = model.age;
                    switch (state.ageRangeFilter) {
                        case "teens": matchesAge = age < 20; break;
                        case "20s": matchesAge = age >= 20 && age < 30; break;
                        case "30s": matchesAge = age >= 30 && age < 40; break;
                        case "40s": matchesAge = age >= 40 && age < 50; break;
                        case "50+": matchesAge = age >= 50; break;
                    }
                }

                // Price Filter
                const modelPrice = model.price || 0; // Treatment for Royalty Free as $0
                const matchesPrice = modelPrice <= state.maxPrice;

                return matchesSearch && matchesType && matchesLicense && matchesGender && matchesRegion && matchesAge && matchesPrice;
            });

            // Sort logic: Allways Recommended (Price High to Low) now
            filtered.sort((a, b) => (b.price || 0) - (a.price || 0));

            // Grid UI
            gridEl.innerHTML = backButtonHtml;
            if (filtered.length === 0 && !backButtonHtml) {
                gridEl.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <h3>No models found</h3>
                        <p>Try adjusting your filters or search term.</p>
                    </div>
                `;
                renderPagination(0);
                return;
            }

            // Pagination slice
            const startIndex = (state.currentPage - 1) * state.itemsPerPage;
            const endIndex = startIndex + state.itemsPerPage;
            const paginatedItems = filtered.slice(startIndex, endIndex);

            paginatedItems.forEach(model => {
                const card = document.createElement("button");
                card.className = "model-card";
                card.setAttribute("aria-label", `View details for ${model.firstName} ${model.lastName}`);
                card.onclick = () => openModal(model);

                let licBadgeText = model.license === "royalty-free" ? "Royalty Free" : "Available to License";
                const inShortlist = state.shortlist.includes(model.id);

                let iconSvg = '';
                if (state.role === 'client') {
                    // Modo Cliente: Corazones
                    iconSvg = inShortlist
                        ? `<svg width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`
                        : `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;
                } else {
                    // Modo Stoodio.ai: Plus y Check
                    iconSvg = inShortlist
                        ? `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>`
                        : `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`;
                }

                let favBtnHtml = '';
                if (!state.isReviewView) {
                    favBtnHtml = `
                        <button class="fav-btn ${inShortlist ? 'active' : ''}" aria-label="Toggle Shortlist" data-id="${model.id}">
                            ${iconSvg}
                        </button>
                    `;
                }

                let consentBadge = '';
                if (model.type === "Real Model" && state.role !== 'client') {
                    consentBadge = `<div style="position: absolute; bottom: 16px; left: 16px; background-color: #f59e0b; color: #fff; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; padding: 4px 10px; border-radius: 4px; z-index: 10; font-family: var(--font-body); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">NO CONSENT YET</div>`;
                }

                card.innerHTML = `
                    <div class="card-image-wrap">
                        ${favBtnHtml}
                        ${consentBadge}
                        <img src="${model.coverPhoto}" alt="${model.firstName}" class="card-image" loading="lazy" width="300" height="400">
                    </div>
                    <div class="card-info">
                        <div class="card-details">
                            <div class="model-name">${model.firstName} ${model.lastName}</div>
                            <div class="model-meta-text">
                                <span>${model.type}</span>
                                <span>&bull;</span>
                                <span>${licBadgeText}</span>
                            </div>
                        </div>
                        <div class="card-action">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                        </div>
                    </div>
                `;

                const favBtn = card.querySelector('.fav-btn');
                if (favBtn) {
                    favBtn.onclick = (e) => {
                        e.stopPropagation();
                        toggleShortlist(model.id, e.currentTarget);
                    };
                }

                gridEl.appendChild(card);
            });

            // Update Header Counter
            const countSpan = document.getElementById("shortlist-count");
            if (countSpan) {
                countSpan.textContent = state.shortlist.length;
            }

            // Inject Integrated Sharing Tools if in Shortlist view
            if (state.showShortlistOnly && state.shortlist.length > 0 && !state.isReviewView) {
                const shareBlock = document.createElement("div");
                shareBlock.className = "share-section";
                shareBlock.style.gridColumn = "1 / -1";
                shareBlock.style.padding = "60px 40px";
                shareBlock.style.marginTop = "40px";
                shareBlock.style.background = "var(--color-surface)";
                shareBlock.style.borderRadius = "24px";
                shareBlock.style.border = "1px solid var(--color-border)";
                shareBlock.style.display = "flex";
                shareBlock.style.flexDirection = "column";
                shareBlock.style.alignItems = "center";
                shareBlock.style.gap = "24px";

                shareBlock.innerHTML = `
                    <div style="text-align:center;">
                        <h3 style="font-size: 24px; margin-bottom: 8px;">Send Pre-selection</h3>
                        <p style="color: var(--color-text-meta); font-size: 14px;">Send this pre-selection directly to a client's email.</p>
                    </div>
                    <form id="shareShortlistForm" style="width: 100%; max-width: 480px; display: flex; flex-direction: column; gap: 16px;">
                        <input type="email" id="clientEmail" placeholder="Client Name or Email Address" required 
                               style="width: 100%; padding: 14px 20px; border-radius: var(--radius-full); border: 1px solid var(--color-border); font-size: 15px;">
                        
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <textarea id="clientMessage" placeholder="Add a personal message (optional) - max 25 words" rows="3"
                                      style="width: 100%; padding: 14px 20px; border-radius: 16px; border: 1px solid var(--color-border); font-size: 15px; font-family: inherit; resize: vertical;"></textarea>
                            <span id="wordCountWarning" style="color: #ef4444; font-size: 12px; display: none; padding-left: 8px;">Maximum 25 words allowed.</span>
                        </div>

                        ${state.role === 'stoodio' ? `
                        <div style="display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px;">
                            <input type="checkbox" id="groupByGender" style="width: 18px; height: 18px; cursor: pointer;">
                            <label for="groupByGender" style="font-size: 14px; cursor: pointer; user-select: none;">Group by Gender (Create folders for client)</label>
                        </div>
                        ` : ''}

                        <button type="submit" class="btn-primary" style="width: 100%;">
                            Send Pre-selection
                        </button>
                    </form>
                    <div id="shareStatusMessage" style="font-size: 14px; font-weight: 500; display: none; text-align: center;"></div>
                    
                    <!-- Copy Link Container -->
                    <div id="shareLinkContainer" style="display: none; width: 100%; max-width: 480px; align-items: center; justify-content: space-between; padding: 14px 20px; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px; margin-top: 8px;">
                        <div id="shareLinkText" style="font-size: 13px; color: var(--color-text-meta); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 75%;"></div>
                        <button id="copyShareLinkBtn" type="button" style="background: none; border: none; font-size: 13px; font-weight: 600; color: var(--color-text); cursor: pointer; transition: color var(--transition-speed); padding: 4px 8px; border-radius: 6px;">Copy Link</button>
                    </div>
                `;

                gridEl.appendChild(shareBlock);

                const form = document.getElementById("shareShortlistForm");
                const submitBtn = form.querySelector('button');
                const clientMsgInput = document.getElementById("clientMessage");
                const wordCountWarning = document.getElementById("wordCountWarning");
                if (clientMsgInput) {
                    clientMsgInput.addEventListener('input', (e) => {
                        const text = e.target.value.trim();
                        const words = text ? text.split(/\s+/) : [];
                        if (words.length > 25) {
                            wordCountWarning.style.display = "block";
                            submitBtn.disabled = true;
                            submitBtn.style.opacity = "0.5";
                        } else {
                            wordCountWarning.style.display = "none";
                            submitBtn.disabled = false;
                            submitBtn.style.opacity = "1";
                        }
                    });
                }

                // Asegurar que el formulario capture bien el mensaje y lo pase a la URL
                form.onsubmit = (e) => {
                    e.preventDefault();
                    const email = document.getElementById("clientEmail").value;
                    const message = document.getElementById("clientMessage").value;
                    const statusMsg = document.getElementById("shareStatusMessage");
                    const submitBtn = form.querySelector('button');

                    submitBtn.disabled = true;
                    submitBtn.textContent = "Processing...";

                    // === GENERAR URL SEGÚN ROL Y MODO ===
                    // URL 1 (Stoodio.ai → Cliente Curado):   ?view=client-curated&catalog=IDs&folders=group1:id1,id2|group2:id3
                    // URL 2 (Stoodio.ai → Cliente Global):   ?view=client-browse
                    // URL 3 (Cliente → Stoodio.ai Revisión): ?view=stoodio-review&picks=IDs
                    const linkParams = new URLSearchParams();

                    if (state.role === 'stoodio') {
                        // El equipo de Stoodio.ai crea catálogo curado para el Cliente
                        linkParams.set("view", "client-curated");
                        linkParams.set("catalog", state.shortlist.join(","));

                        // Lógica de Agrupación de Carpetas
                        const groupByGenderCheckbox = document.getElementById("groupByGender");
                        if (groupByGenderCheckbox && groupByGenderCheckbox.checked) {
                            const shortlistedModels = MODELS.filter(m => state.shortlist.includes(m.id));
                            const females = shortlistedModels.filter(m => m.gender === 'Female').map(m => m.id);
                            const males = shortlistedModels.filter(m => m.gender === 'Male').map(m => m.id);
                            const others = shortlistedModels.filter(m => m.gender !== 'Female' && m.gender !== 'Male').map(m => m.id);

                            let folderString = [];
                            if (females.length > 0) folderString.push(`Female:${females.join(",")}`);
                            if (males.length > 0) folderString.push(`Male:${males.join(",")}`);
                            if (others.length > 0) folderString.push(`Other:${others.join(",")}`);

                            if (folderString.length > 0) {
                                linkParams.set("folders", folderString.join("|"));
                            }
                        }

                    } else {
                        // Cliente devuelve su selección a la Stoodio.ai para revisión
                        linkParams.set("view", "stoodio-review");
                        if (state.isCuratedCatalog) {
                            // Referencia al catálogo original para contexto
                            const currentIds = originalModels.map(m => m.id);
                            linkParams.set("catalog-ref", currentIds.join(","));
                        }
                        linkParams.set("picks", state.shortlist.join(","));
                        if (email) linkParams.set("client", email);
                        if (message) linkParams.set("msg", message);
                    }

                    const shareLinkBase = window.location.origin + window.location.pathname;
                    const shareLink = `${shareLinkBase}?${linkParams.toString()}`;

                    // Simulated sending (as it's a static site)
                    // In a real scenario, here we call an API or EmailJS
                    setTimeout(() => {
                        form.style.display = "none"; // Ocultar formulario al éxito
                        statusMsg.style.display = "block";
                        statusMsg.style.color = "#059669";
                        statusMsg.textContent = `✓ Pre-selection successfully sent to ${email}`;

                        submitBtn.textContent = "Sent!";
                        submitBtn.style.background = "#059669";

                        // Simular log de envío de email
                        console.group("📧 Email Sent to Client / Stoodio.ai");
                        console.log("To:", email);
                        console.log("Message:", message || "(No personal message appended)");
                        console.log("Link:", shareLink);
                        console.groupEnd();

                        // Revelar enlace para copiar
                        const linkContainer = document.getElementById("shareLinkContainer");
                        const linkText = document.getElementById("shareLinkText");
                        const copyBtn = document.getElementById("copyShareLinkBtn");

                        if (linkContainer && linkText && copyBtn) {
                            linkText.textContent = shareLink;
                            linkContainer.style.display = "flex";

                            // Lógica de copiado
                            copyBtn.onclick = () => {
                                navigator.clipboard.writeText(shareLink).then(() => {
                                    copyBtn.textContent = "Copied ✓";
                                    copyBtn.style.color = "#059669";
                                    setTimeout(() => {
                                        copyBtn.textContent = "Copy Link";
                                        copyBtn.style.color = "var(--color-text)";
                                    }, 2000);
                                });
                            };
                        }

                        setTimeout(() => {
                            statusMsg.style.display = "none";
                            submitBtn.disabled = false;
                            submitBtn.textContent = "Send Pre-selection";
                            submitBtn.style.background = "var(--color-accent)";
                            // Limpiar campos
                            document.getElementById("clientEmail").value = "";
                            document.getElementById("clientMessage").value = "";

                            // Restaurar vista
                            form.style.display = "flex";
                            const tempLinkContainer = document.getElementById("shareLinkContainer");
                            if (tempLinkContainer) tempLinkContainer.style.display = "none";
                        }, 4000);
                    }, 1200);
                };
            }

            renderPagination(filtered.length);
        }

        function renderPagination(totalItems) {
            const paginationEl = document.getElementById("paginationControls");
            paginationEl.innerHTML = "";

            const totalPages = Math.ceil(totalItems / state.itemsPerPage);
            if (totalPages <= 1) return; // Ocultar si solo hay una página

            // Prev Button
            const prevBtn = document.createElement("button");
            prevBtn.className = "page-btn";
            prevBtn.innerHTML = `&larr;`;
            prevBtn.disabled = state.currentPage === 1;
            prevBtn.onclick = () => {
                state.currentPage--;
                renderCards();
                window.scrollTo({ top: document.getElementById('showroom-grid').offsetTop - 120, behavior: 'smooth' });
            };
            paginationEl.appendChild(prevBtn);

            // Page Numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement("button");
                pageBtn.className = "page-btn" + (i === state.currentPage ? " active" : "");
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    state.currentPage = i;
                    renderCards();
                    window.scrollTo({ top: document.getElementById('showroom-grid').offsetTop - 120, behavior: 'smooth' });
                };
                paginationEl.appendChild(pageBtn);
            }

            // Next Button
            const nextBtn = document.createElement("button");
            nextBtn.className = "page-btn";
            nextBtn.innerHTML = `&rarr;`;
            nextBtn.disabled = state.currentPage === totalPages;
            nextBtn.onclick = () => {
                state.currentPage++;
                renderCards();
                window.scrollTo({ top: document.getElementById('showroom-grid').offsetTop - 120, behavior: 'smooth' });
            };
            paginationEl.appendChild(nextBtn);
        }

        /* === EVENTS === */
        searchInput.addEventListener("input", (e) => {
            state.searchQuery = e.target.value;
            state.currentPage = 1; // Reset to page 1 on search
            updateURL();
            renderCards();
        });

        priceRange.addEventListener("input", (e) => {
            const val = parseInt(e.target.value);
            state.maxPrice = val;
            priceValue.textContent = val === 1000 ? "Up to $1000+" : `Up to $${val}`;
        });



        typeFilterBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                const filter = btn.dataset.filter;

                if (filter === "all") {
                    typeFilterBtns.forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    state.typeFilters = [];
                } else {
                    typeFilterBtns[0].classList.remove("active"); // Remove "All" active
                    btn.classList.toggle("active");

                    // Rebuild array based on active buttons
                    state.typeFilters = Array.from(typeFilterBtns)
                        .filter(b => b.classList.contains("active") && b.dataset.filter !== "all")
                        .map(b => b.dataset.filter);

                    // If no specific filters remain, fall back to "All"
                    if (state.typeFilters.length === 0) {
                        typeFilterBtns[0].classList.add("active");
                    }
                }

                state.currentPage = 1;
                updateURL();
                renderCards();
            });
        });

        licenseFilterBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                const filter = btn.dataset.filter;

                if (filter === "all") {
                    licenseFilterBtns.forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    state.licenseFilters = [];
                } else {
                    licenseFilterBtns[0].classList.remove("active"); // Remove "All" active
                    btn.classList.toggle("active");

                    // Rebuild array based on active buttons
                    state.licenseFilters = Array.from(licenseFilterBtns)
                        .filter(b => b.classList.contains("active") && b.dataset.filter !== "all")
                        .map(b => b.dataset.filter);

                    // If no specific filters remain, fall back to "All"
                    if (state.licenseFilters.length === 0) {
                        licenseFilterBtns[0].classList.add("active");
                    }
                }

                state.currentPage = 1;
                updateURL();
                renderCards();
            });
        });

        /* === ADVANCED FILTERS LOGIC === */
        advancedFiltersBtn.addEventListener("click", () => {
            filtersOverlay.classList.add("active");
            document.body.style.overflow = "hidden";
        });

        const closeDrawer = () => {
            filtersOverlay.classList.remove("active");
            document.body.style.overflow = "";
        };

        closeDrawerBtn.addEventListener("click", closeDrawer);
        filtersOverlay.addEventListener("click", (e) => {
            if (e.target === filtersOverlay) closeDrawer();
        });

        const handleDrawerPillClick = (btns, stateKey, dataAttr = stateKey.replace('Filter', '')) => {
            btns.forEach(btn => {
                btn.addEventListener("click", () => {
                    btns.forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    state[stateKey] = btn.getAttribute(`data-${dataAttr}`);
                });
            });
        };

        handleDrawerPillClick(genderBtns, "genderFilter");
        handleDrawerPillClick(ageBtns, "ageRangeFilter");
        handleDrawerPillClick(regionBtns, "regionFilter");

        const resetAdvancedFiltersUI = () => {
            state.genderFilter = "all";
            state.ageRangeFilter = "all";
            state.regionFilter = "all";
            state.maxPrice = 1000;

            if (priceRange) priceRange.value = 1000;
            if (priceValue) priceValue.textContent = "Up to $1000+";

            [genderBtns, ageBtns, regionBtns].forEach(group => {
                group.forEach(btn => {
                    btn.classList.remove("active");
                    const val = btn.getAttribute("data-gender") || btn.getAttribute("data-age") || btn.getAttribute("data-region");
                    if (val === "all") {
                        btn.classList.add("active");
                    }
                });
            });
        };

        applyFiltersBtn.addEventListener("click", () => {
            state.currentPage = 1;
            updateURL();
            renderCards();
            closeDrawer();
        });

        clearFiltersBtn.addEventListener("click", () => {
            resetAdvancedFiltersUI();
            state.currentPage = 1;
            updateURL();
            renderCards();
            closeDrawer();
        });

        /* === MODAL LOGIC === */
        function openModal(model) {
            document.body.style.overflow = "hidden"; // Prevent background scroll

            // Populate data
            document.getElementById("modalMainImage").src = model.coverPhoto;
            document.getElementById("modalName").textContent = `${model.firstName} ${model.lastName}`;
            document.getElementById("modalId").textContent = model.id;

            document.getElementById("modalType").textContent = model.type;
            document.getElementById("modalGender").textContent = model.gender || "-";
            document.getElementById("modalAge").textContent = model.age ? `${model.age} years` : "-";
            document.getElementById("modalCountry").textContent = model.country || "-";

            const flagImg = document.getElementById("modalFlag");
            if (model.countryCode) {
                flagImg.src = `https://flagcdn.com/w20/${model.countryCode.toLowerCase()}.png`;
                flagImg.style.display = "inline-block";
                flagImg.alt = model.country;
            } else {
                flagImg.style.display = "none";
            }

            if (model.license === "royalty-free") {
                document.getElementById("modalLicense").textContent = "Royalty Free";
                document.getElementById("modalPrice").textContent = "Free";
            } else {
                document.getElementById("modalLicense").textContent = "Available to License";
                document.getElementById("modalPrice").textContent = `$${model.price} / project`;
            }

            // Populate Gallery
            const galleryEl = document.getElementById("modalGallery");
            const galleryWrapper = document.getElementById("modalGalleryWrapper");
            galleryEl.innerHTML = "";

            // Re-bind exact photo behavior
            model.portfolioPhotos.forEach((photoUrl, index) => {
                const img = document.createElement("img");
                img.src = photoUrl;
                img.className = "gallery-thumb" + (index === 0 ? " active" : "");
                img.onclick = () => {
                    document.getElementById("modalMainImage").src = photoUrl;
                    document.querySelectorAll(".gallery-thumb").forEach(t => t.classList.remove("active"));
                    img.classList.add("active");
                };
                galleryEl.appendChild(img);
            });

            // Handle chevron visibility - simplified logic based purely on photo count
            if (model.portfolioPhotos.length > 3) {
                galleryWrapper.style.display = "flex";
                document.getElementById("galleryPrevBtn").style.display = "flex";
                document.getElementById("galleryNextBtn").style.display = "flex";
                galleryEl.style.justifyContent = "flex-start";
            } else if (model.portfolioPhotos.length > 1) {
                galleryWrapper.style.display = "flex";
                document.getElementById("galleryPrevBtn").style.display = "none";
                document.getElementById("galleryNextBtn").style.display = "none";
                galleryEl.style.justifyContent = "center";
            } else {
                galleryWrapper.style.display = "none";
            }

            // Connect button to Shortlist logic
            const reqBtn = document.getElementById("requestModelBtn");
            const updateBtnStatus = () => {
                const isShortlisted = state.shortlist.includes(model.id);
                reqBtn.textContent = isShortlisted ? "Remove from Shortlist" : "Add to Shortlist";
                reqBtn.classList.toggle("btn-active", isShortlisted); // Optional: if we want a different style
            };

            updateBtnStatus();

            reqBtn.onclick = () => {
                toggleShortlist(model.id);
                updateBtnStatus();
            };

            // Show modal
            modalOverlay.classList.add("active");

            // Sync favorite state
            const mFavBtn = document.getElementById("modalFavBtn");
            if (state.shortlist.includes(model.id)) {
                mFavBtn.classList.add("active");
                mFavBtn.innerHTML = `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
            } else {
                mFavBtn.classList.remove("active");
                mFavBtn.innerHTML = `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`;
            }
        }

        function closeModal() {
            document.body.style.overflow = "";
            modalOverlay.classList.remove("active");
        }

        closeModalBtn.addEventListener("click", closeModal);
        modalOverlay.addEventListener("click", (e) => {
            if (e.target === modalOverlay) {
                closeModal();
            }
        });

        // Gallery Chevron Controls
        document.getElementById("galleryPrevBtn").addEventListener("click", () => {
            document.getElementById("modalGallery").scrollBy({ top: -120, behavior: 'smooth' });
        });
        document.getElementById("galleryNextBtn").addEventListener("click", () => {
            document.getElementById("modalGallery").scrollBy({ top: 120, behavior: 'smooth' });
        });

        /* === LOGICA MICRO-ANIMACION === */
        function triggerHeartDustAnimation(sourceElement) {
            // Solo animar si es modo cliente
            if (state.role !== 'client') return;

            const rect = sourceElement.getBoundingClientRect();
            const startX = rect.left + rect.width / 2;
            const startY = rect.top + rect.height / 2;

            const targetEl = document.getElementById("shortlistViewBtn");
            if (!targetEl) return;
            const targetRect = targetEl.getBoundingClientRect();
            const endX = targetRect.left + targetRect.width / 2;
            const endY = targetRect.top + targetRect.height / 2;

            const flyingHeart = document.createElement("div");
            flyingHeart.className = "flying-heart";
            flyingHeart.innerHTML = `<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;

            // Establecer posición inicial absoluta
            flyingHeart.style.left = `${startX - 12}px`;
            flyingHeart.style.top = `${startY - 12}px`;

            // Establecer deltas para que CSS anime la trayectoria
            const dx = endX - startX;
            const dy = endY - startY;
            flyingHeart.style.setProperty('--dx', `${dx}px`);
            flyingHeart.style.setProperty('--dy', `${dy}px`);

            document.body.appendChild(flyingHeart);

            // Eliminar elemento al terminar animación
            setTimeout(() => {
                if (flyingHeart.parentNode) flyingHeart.parentNode.removeChild(flyingHeart);
            }, 800);
        }

        /* === SHORTLIST LOGIC === */
        function toggleShortlist(id, sourceElement = null) {
            const index = state.shortlist.indexOf(id);
            if (index > -1) {
                state.shortlist.splice(index, 1);
            } else {
                state.shortlist.push(id);
                // Si agregamos y tenemos un sourceElement (el botón), lanzamos la animación
                if (sourceElement) {
                    triggerHeartDustAnimation(sourceElement);
                }
            }
            localStorage.setItem('stoodio_shortlist', JSON.stringify(state.shortlist));
            updateURL();

            // Sync UI
            renderCards();

            // Sincronizar modal open state si aplica
            const modalIdEl = document.getElementById("modalId");
            if (modalOverlay.classList.contains("active") && modalIdEl && modalIdEl.textContent === id) {
                const mFavBtn = document.getElementById("modalFavBtn");
                const mReqBtn = document.getElementById("requestModelBtn");
                const isShortlisted = state.shortlist.includes(id);

                if (isShortlisted) {
                    mFavBtn.classList.add("active");
                    if (state.role === 'client') {
                        mFavBtn.innerHTML = `<svg width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;
                    } else {
                        mFavBtn.innerHTML = `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
                    }
                    if (mReqBtn) mReqBtn.textContent = "Remove from Shortlist";
                } else {
                    mFavBtn.classList.remove("active");
                    if (state.role === 'client') {
                        mFavBtn.innerHTML = `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;
                    } else {
                        mFavBtn.innerHTML = `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`;
                    }
                    if (mReqBtn) mReqBtn.textContent = "Add to Shortlist";
                }
            }
        }

        function goHome() {
            state.isReviewView = false;
            const controlsWrapper = document.querySelector(".controls-wrapper");
            if (controlsWrapper) controlsWrapper.style.display = "flex";
            const headerRight = document.querySelector(".header-right");
            if (headerRight) headerRight.style.display = "flex";

            state.showShortlistOnly = false;
            state.typeFilters = [];
            state.licenseFilters = [];
            state.searchQuery = "";
            state.currentPage = 1;
            resetAdvancedFiltersUI();

            // Reset Search Input
            searchInput.value = "";

            // Reset Píldoras UI
            typeFilterBtns.forEach(b => b.classList.remove("active"));
            typeFilterBtns[0].classList.add("active");

            licenseFilterBtns.forEach(b => b.classList.remove("active"));
            licenseFilterBtns[0].classList.add("active");

            // Reset Header Nav UI
            if (catalogBtn) catalogBtn.classList.add("active");
            if (shortlistViewBtn) shortlistViewBtn.classList.remove("active-view");

            renderCards();
            updateURL();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById("logoLink").addEventListener("click", goHome);
        if (catalogBtn) catalogBtn.addEventListener("click", goHome);

        if (shortlistViewBtn) {
            shortlistViewBtn.addEventListener("click", (e) => {
                state.showShortlistOnly = true;
                state.currentPage = 1;

                if (catalogBtn) catalogBtn.classList.remove("active");
                shortlistViewBtn.classList.add("active-view");

                // Clean filters
                state.typeFilters = [];
                state.licenseFilters = [];
                state.searchQuery = "";
                searchInput.value = "";
                resetAdvancedFiltersUI();

                typeFilterBtns.forEach(b => b.classList.remove("active"));
                typeFilterBtns[0].classList.add("active");
                licenseFilterBtns.forEach(b => b.classList.remove("active"));
                licenseFilterBtns[0].classList.add("active");

                renderCards();
                updateURL();
                window.scrollTo({ top: document.getElementById('showroom-grid').offsetTop - 120, behavior: 'smooth' });
            });
        }

        // Initialize modal favorite click loop
        document.getElementById("modalFavBtn").onclick = (e) => {
            const currentId = document.getElementById("modalId").textContent;
            toggleShortlist(currentId, e.currentTarget);
        };

        /* === DEEP LINKING === */
        function updateURL() {
            const params = new URLSearchParams();
            if (state.genderFilter !== "all") params.set("gender", state.genderFilter);
            if (state.ageRangeFilter !== "all") params.set("age", state.ageRangeFilter);
            if (state.regionFilter !== "all") params.set("region", state.regionFilter);
            if (state.typeFilters.length > 0) params.set("types", state.typeFilters.join(","));
            if (state.licenseFilters.length > 0) params.set("licenses", state.licenseFilters.join(","));
            if (state.searchQuery) params.set("search", state.searchQuery);
            if (state.maxPrice < 1000) params.set("maxPrice", state.maxPrice);

            // === URLs DESCRIPTIVAS POR ROL Y MODO ===
            // URL 1: Stoodio.ai browsing full catalog (default, sin parámetro extra)
            // URL 2: Client browsing a curated catalog  --> ?view=client-curated&catalog=ID1,ID2
            // URL 3: Client browsing full catalog       --> ?view=client-browse

            if (state.role === 'client') {
                if (state.isCuratedCatalog) {
                    params.set("view", "client-curated");
                    const currentIds = originalModels.map(m => m.id);
                    params.set("catalog", currentIds.join(","));
                } else {
                    params.set("view", "client-browse");
                }
            }
            // La Stoodio.ai (stoodio) es el default: no añadimos parámetro view

            if (state.showShortlistOnly && state.shortlist.length > 0) {
                params.set("picks", state.shortlist.join(","));
            }
            if (state.isAdmin) params.set("admin", "true");

            const newURL = `${window.location.pathname}${params.toString() ? "?" + params.toString() : ""}`;
            window.history.replaceState({}, "", newURL);
        }

        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);

            // === PARSEAR URLS DESCRIPTIVAS POR ROL Y MODO ===
            // Soportamos tanto el nuevo parámetro 'view' como el antiguo 'role' (retrocompatibilidad)
            const viewParam = params.get("view");
            const roleParam = params.get("role");

            // Evitar pre-selección residual: si es un link compartido, la selección parte de 0 
            // a menos que contenga el parámetro 'picks' que la rellenará más adelante.
            if (viewParam || roleParam) {
                state.shortlist = [];
            }

            if (viewParam === "client-curated") {
                state.role = 'client';
                state.isCuratedCatalog = true;
            } else if (viewParam === "client-browse") {
                state.role = 'client';
            } else if (viewParam === "stoodio-review") {
                state.isReviewView = true;
                const controlsWrapper = document.querySelector(".controls-wrapper");
                if (controlsWrapper) controlsWrapper.style.display = "none";

                // No ocultamos header-right por completo para mantener la navegación visible
                // Pero podemos ocultar elementos específicos si fuera necesario más adelante.

                // El equipo de Stoodio.ai recibe de vuelta la selección del Cliente
                const clientEmail = params.get("client") || 'Client';
                const clientMsg = params.get("msg");

                const heroInner = document.querySelector(".hero-inner");
                if (heroInner) {
                    const messageHtml = clientMsg ? (
                        '<div style="position: relative; padding-left: 20px; border-left: 2px solid var(--color-accent);">' +
                        '<svg width="24" height="24" viewBox="0 0 24 24" fill="var(--color-border)" style="position: absolute; top: -12px; left: -14px; opacity: 0.6; z-index: 0;"><path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/></svg>' +
                        '<p style="position: relative; z-index: 1; font-family: var(--font-heading); font-size: 22px; font-style: italic; font-weight: 400; color: var(--color-text); line-height: 1.5; margin: 0;">' +
                        '"' + clientMsg.replace(/\n/g, '<br>') + '"' +
                        '</p>' +
                        '</div>'
                    ) : '';

                    const marginBtm = clientMsg ? '32px' : '0';

                    heroInner.innerHTML = `
                        <div style="display: flex; flex-wrap: wrap; gap: 40px; justify-content: space-between; align-items: stretch; margin-top: 16px;">
                            <div style="flex: 1; min-width: 300px; max-width: 600px; display: flex; flex-direction: column; justify-content: center;">
                                <h1 style="font-family: var(--font-body); font-size: clamp(2.5rem, 4vw, 3.5rem); font-weight: 600; letter-spacing: -0.03em; line-height: 1.1; color: var(--color-text); margin-bottom: 24px; white-space: normal;">
                                    Client Selection<br>Review
                                </h1>
                                <p style="font-size: 18px; font-weight: 300; letter-spacing: 0.01em; color: var(--color-text-light); line-height: 1.6; margin: 0; max-width: 480px;">
                                    The following models have been pre-selected by your client. Please review the selection below to proceed with the requested talent.
                                </p>
                            </div>
                            
                            <div style="flex: 1; min-width: 320px; max-width: 500px; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 20px; padding: 32px 40px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 12px 24px -12px rgba(0,0,0,0.05);">
                                <div style="font-family: var(--font-body); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--color-text-meta); margin-bottom: 8px;">
                                    Sent By
                                </div>
                                <div style="font-family: var(--font-body); font-size: 18px; font-weight: 600; color: var(--color-text); margin-bottom: ${marginBtm}; line-height: 1.4;">
                                    ${clientEmail}
                                </div>
                                ${messageHtml}
                            </div>
                        </div>
                    `;
                    heroInner.style.borderBottom = 'none';
                    heroInner.style.paddingBottom = '0';
                    heroInner.style.marginBottom = '20px';
                }
            } else if (roleParam === 'client') {
                // Retrocompatibilidad con el parámetro antiguo
                state.role = 'client';
            }

            if (params.has("catalog")) {
                const catalogIds = params.get("catalog").split(",");
                // El catálogo se restringe: la base de datos entera pasa a ser solo esos modelos
                originalModels = originalModels.filter(m => catalogIds.includes(m.id));
                filteredModels = [...originalModels];
                state.isCuratedCatalog = true;

                // Parse folders if present e.g folders=Female:ID1,ID2|Male:ID3
                if (params.has("folders")) {
                    const foldersStr = params.get("folders");
                    state.folders = {};
                    foldersStr.split("|").forEach(fGroup => {
                        const [fName, fIds] = fGroup.split(":");
                        if (fName && fIds) {
                            state.folders[fName] = fIds.split(",");
                        }
                    });
                }
            }

            if (params.has("gender")) state.genderFilter = params.get("gender");
            if (params.has("age")) state.ageRangeFilter = params.get("age");
            if (params.has("region")) state.regionFilter = params.get("region");
            if (params.has("types")) state.typeFilters = params.get("types").split(",");
            if (params.has("licenses")) state.licenseFilters = params.get("licenses").split(",");
            if (params.has("search")) {
                state.searchQuery = params.get("search");
                searchInput.value = state.searchQuery;
            }
            if (params.has("maxPrice")) {
                state.maxPrice = parseInt(params.get("maxPrice"));
            }
            // Soportar tanto 'picks' (nuevo) como 'selection' (antiguo)
            const picksParam = params.get("picks") || params.get("selection");
            if (picksParam) {
                state.shortlist = picksParam.split(",");
                state.showShortlistOnly = true;
                if (catalogBtn) catalogBtn.classList.remove("active");
                if (shortlistViewBtn) shortlistViewBtn.classList.add("active-view");
            }

            if (params.get("admin") === "true") {
                state.isAdmin = true;
                showAdminTools();
            }

            // Sync document role data attribute para CSS (colores dinámicos)
            document.body.setAttribute("data-role", state.role);

            // Alinear botón superior según el rol estáticamente en el primer load
            const sBtnTxt = document.getElementById("shortlistBtnText");
            const hIcon = document.getElementById("headerShortlistIcon");
            if (sBtnTxt) {
                if (state.role === 'client') {
                    sBtnTxt.innerHTML = 'My Pre-selection (<span id="shortlist-count">0</span>)';
                } else {
                    sBtnTxt.innerHTML = 'Shortlist (<span id="shortlist-count">0</span>)';
                }
            }
            if (hIcon) {
                if (state.role === 'client') {
                    hIcon.innerHTML = `<svg width="18" height="18" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="margin-top: -1px;"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;
                } else {
                    hIcon.innerHTML = `<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="margin-top: -1px;"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;
                }
            }

            // Update UI components
            syncFiltersUI();
            renderCards();
        }

        function syncFiltersUI() {
            // Update pills
            typeFilterBtns.forEach(btn => {
                const isActive = state.typeFilters.includes(btn.dataset.filter) || (btn.dataset.filter === "all" && state.typeFilters.length === 0);
                if (isActive) {
                    btn.classList.add("active");
                } else {
                    btn.classList.remove("active");
                }
            });
            licenseFilterBtns.forEach(btn => {
                const isActive = state.licenseFilters.includes(btn.dataset.filter) || (btn.dataset.filter === "all" && state.licenseFilters.length === 0);
                if (isActive) {
                    btn.classList.add("active");
                } else {
                    btn.classList.remove("active");
                }
            });

            // Sync drawer pills
            [genderBtns, ageBtns, regionBtns].forEach(group => {
                group.forEach(btn => {
                    const type = btn.dataset.gender ? "genderFilter" : btn.dataset.age ? "ageRangeFilter" : "regionFilter";
                    const val = btn.dataset.gender || btn.dataset.age || btn.dataset.region;
                    if (state[type] === val) {
                        btn.classList.add("active");
                    } else {
                        btn.classList.remove("active");
                    }
                });
            });

            // Sync price slider
            if (priceRange) {
                priceRange.value = state.maxPrice;
                priceValue.textContent = state.maxPrice === 1000 ? "Up to $1000+" : `Up to $${state.maxPrice} `;
            }
        }

        /* === ADMIN TOOLS === */
        function showAdminTools() {
            const header = document.querySelector(".header-content");
            if (document.getElementById("admin-tools-panel")) return;

            const adminTools = document.createElement("div");
            adminTools.id = "admin-tools-panel";
            adminTools.style.cssText = `
                    display: flex;
                    gap: 12px;
                    align - items: center;
                    background: #fdf2f2;
                    padding: 8px 16px;
                    border - radius: 99px;
                    border: 1px solid #fecaca;
                    `;
            adminTools.innerHTML = `
                        < span style = "font-size: 11px; font-weight: 700; color: #991b1b; text-transform: uppercase;" > Admin Mode</span >
                            <button class="btn-outline" style="padding: 6px 14px; font-size: 10px; background: #991b1b;" id="copyClientLink">Copy Client Link</button>
            `;
            header.insertBefore(adminTools, header.querySelector(".header-nav-center"));

            document.getElementById("copyClientLink").onclick = () => {
                updateURL();
                navigator.clipboard.writeText(window.location.href);
                const btn = document.getElementById("copyClientLink");
                const originalText = btn.textContent;
                btn.textContent = "Link Copied!";
                btn.style.background = "#059669";
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = "#991b1b";
                }, 2000);
            };
        }

        // Initialize
        loadFromURL();

    </script>
</body>

</html>